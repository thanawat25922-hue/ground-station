<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CANSAT TELEMETRY</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #1e1e1e;
    color: white;
}

.container {
    display: flex;
    height: 100vh;
}

.telemetry {
    width: 35%;
    background: #2b2b2b;
    padding: 15px;
    box-sizing: border-box;
}

.telemetry h2 {
    text-align: center;
    margin-bottom: 15px;
}

.grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px 15px;
}

.label {
    font-size: 13px;
}

.value {
    color: #00ffcc;
    font-weight: bold;
    text-align: right;
}

.graph {
    width: 65%;
    padding: 20px;
    box-sizing: border-box;
}

select {
    margin-bottom: 10px;
    padding: 5px;
}
</style>
</head>

<body>

<div class="container">

    <!-- TELEMETRY -->
    <div class="telemetry">
        <h2>TELEMETRY</h2>
        <div class="grid" id="telemetryGrid"></div>
    </div>

    <!-- GRAPH -->
    <div class="graph">
        <select id="graphSelect">
            <option value="altitude">Altitude</option>
            <option value="temperature">Temperature</option>
            <option value="pressure">Pressure</option>
            <option value="voltage">Voltage</option>
        </select>
        <canvas id="chart"></canvas>
    </div>

</div>

<script>
const fields = [
"TEAM ID","MISSION TIME",
"PACKET COUNT","MODE",
"VOLTAGE","STATE",
"ALTITUDE","GYRO PITCH",
"PRESSURE","GYRO ROLL",
"TEMPERATURE","GYRO YAW",
"ACCELERATION YAW","ACCELERATION PITCH",
"GPS STATE","ACCELERATION ROLL",
"GPS LONGITUDE","GPS LATITUDE",
"","GPS TIME"
];

const grid = document.getElementById("telemetryGrid");

let values = {};

fields.forEach(name => {
    const label = document.createElement("div");
    label.className = "label";
    label.innerText = name;

    const value = document.createElement("div");
    value.className = "value";
    value.innerText = "0";

    grid.appendChild(label);
    grid.appendChild(value);

    values[name] = value;
});

// ================= CHART =================
const ctx = document.getElementById('chart').getContext('2d');

let chartData = {
    labels: [],
    datasets: [{
        label: "Altitude",
        data: [],
        borderColor: "#00ffcc",
        fill: false
    }]
};

let chart = new Chart(ctx, {
    type: 'line',
    data: chartData,
    options: {
        responsive: true,
        scales: {
            x: { ticks: { color: "white" }},
            y: { ticks: { color: "white" }}
        },
        plugins: {
            legend: { labels: { color: "white" }}
        }
    }
});

// ================= DATA UPDATE =================
let startTime = Date.now();
let packet = 0;

function updateData() {

    packet++;

    let missionTime = Math.floor((Date.now() - startTime) / 1000);

    let alt = 100 + Math.random()*20;
    let temp = 25 + Math.random()*10;
    let pres = 1000 + Math.random()*15;
    let volt = 7.2 + Math.random()*1.2;

    // update telemetry
    values["TEAM ID"].innerText = "2034";
    values["MISSION TIME"].innerText = missionTime + " s";
    values["PACKET COUNT"].innerText = packet;
    values["MODE"].innerText = "FLIGHT";
    values["VOLTAGE"].innerText = volt.toFixed(2) + " V";
    values["STATE"].innerText = "ASCENT";
    values["ALTITUDE"].innerText = alt.toFixed(2) + " m";
    values["PRESSURE"].innerText = pres.toFixed(2) + " hPa";
    values["TEMPERATURE"].innerText = temp.toFixed(2) + " Â°C";
    values["GYRO PITCH"].innerText = "1.2";
    values["GYRO ROLL"].innerText = "0.8";
    values["GYRO YAW"].innerText = "0.3";
    values["ACCELERATION PITCH"].innerText = "0.02";
    values["ACCELERATION ROLL"].innerText = "0.01";
    values["ACCELERATION YAW"].innerText = "0.00";
    values["GPS STATE"].innerText = "LOCK";
    values["GPS LATITUDE"].innerText = "13.7563";
    values["GPS LONGITUDE"].innerText = "100.5018";
    values["GPS TIME"].innerText = new Date().toLocaleTimeString();

    // graph update
    chartData.labels.push(packet);

    let selected = document.getElementById("graphSelect").value;

    if(selected === "altitude") chartData.datasets[0].data.push(alt);
    if(selected === "temperature") chartData.datasets[0].data.push(temp);
    if(selected === "pressure") chartData.datasets[0].data.push(pres);
    if(selected === "voltage") chartData.datasets[0].data.push(volt);

    chartData.datasets[0].label =
        selected.charAt(0).toUpperCase() + selected.slice(1);

    if(chartData.labels.length > 20){
        chartData.labels.shift();
        chartData.datasets[0].data.shift();
    }

    chart.update();
}

setInterval(updateData, 1000);
</script>

</body>
</html>
